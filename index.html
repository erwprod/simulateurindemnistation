<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulateur d‚Äôindemnisation ‚Äì Dommage corporel</title>
  <meta name="description" content="Estimation indicative de l‚Äôindemnisation en dommage corporel. Obtenez une estimation affin√©e gratuite par un avocat.">
  <meta property="og:title" content="Simulateur d‚Äôindemnisation ‚Äì Dommage corporel">
  <meta property="og:description" content="Estimation indicative et gratuite. Sans engagement.">
  <meta property="og:type" content="website">
  <style>
    :root{
      --bg:#0b0f14;
      --card:#121824;
      --muted:#1a2230;
      --text:#e8eef8;
      --sub:#a7b3c7;
      --accent:#5ec2ff;
      --accent-2:#43e0b5;
      --danger:#ff6b6b;
      --ok:#7ce38b;
      --focus: 0 0 0 3px rgba(94,194,255,.35);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg, #0b0f14 0%, #0e1420 100%);
      color:var(--text);
      line-height:1.45;
    }
    a{color:var(--accent)}
    header{
      padding:24px 16px 8px;
      position:sticky; top:0; z-index:10;
      background: linear-gradient(180deg, rgba(11,15,20,.92), rgba(11,15,20,.75) 70%, rgba(11,15,20,0));
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px); /* Safari support */
      border-bottom:1px solid #182034;
    }
    .container{max-width:1100px; margin:0 auto; padding:0 16px;}
    .hero{
      display:grid; grid-template-columns:1.2fr .8fr; gap:20px; align-items:center;
    }
    h1{font-size:clamp(22px, 3.4vw, 36px); margin:6px 0 8px}
    .sub{color:var(--sub); margin:0 0 4px; font-size:14px}
    .badge{display:inline-flex; gap:8px; align-items:center; background:var(--muted); color:#cfe4ff; padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid #2a3550}
    .grid{display:grid; gap:16px}
    .layout{grid-template-columns:1.1fr .9fr}
    .card{
      background:linear-gradient(180deg, #0f1522, #0f1524);
      border:1px solid #1f2b46;
      border-radius:var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
      padding:18px;
    }
    .sticky{
      position:sticky; top:84px;
      max-height:calc(100vh - 100px);
      overflow:auto;
    }
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    label{display:block; font-weight:600; font-size:13px; margin:6px 0}
    .help{color:var(--sub); font-size:12px; margin-top:4px}
    input, select, textarea{
      width:100%; padding:10px 12px; border-radius:12px;
      background:#0e1420; color:var(--text);
      border:1px solid #22304a;
      outline:none;
    }
    input:focus, select:focus, textarea:focus{box-shadow:var(--focus); border-color:#2d8fff}
    .stepper{display:flex; gap:8px; margin:4px 0 16px}
    .step{
      flex:1; text-align:center; font-size:12px; color:#cfe4ff;
      padding:8px; border-radius:12px; background:#0d1422; border:1px solid #1e2840;
    }
    .step.active{background:linear-gradient(180deg,#122036,#0d1627); border-color:#2a3a60; box-shadow:inset 0 0 0 1px #314774}
    .actions{display:flex; gap:10px; justify-content:space-between; margin-top:12px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px; border-radius:12px; border:1px solid #28406e; background:#15223a; color:#eaf3ff; font-weight:700; cursor:pointer;
    }
    .btn.primary{background:linear-gradient(180deg,#1a8fff,#4db7ff); border-color:#3aa3ff; color:#04121f}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .note{font-size:12px; color:#cbd7eb}
    .alert{background:#1a2030; border:1px solid #2a3556; padding:10px; border-radius:12px; font-size:13px; color:#e9f1ff}
    .warn{border-left:4px solid var(--danger); padding-left:10px}
    .ok{border-left:4px solid var(--ok); padding-left:10px}
    .meter{
      display:grid; gap:8px; margin-top:10px;
    }
    .bar{
      height:14px; background:#0c1a2a; border:1px solid #274065; border-radius:999px; position:relative; overflow:hidden;
    }
    .bar > i{
      position:absolute; top:0; left:0; bottom:0; width:20%; background:linear-gradient(90deg, var(--accent), var(--accent-2));
    }
    .result-grid{display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-top:8px}
    .pill{
      background:#0d1422; border:1px solid #1e2b46; border-radius:12px; padding:10px; text-align:center;
    }
    .pill strong{display:block; font-size:18px}
    .list{display:grid; gap:6px; margin:8px 0}
    .list li{display:flex; align-items:center; gap:8px}
    .faq dt{font-weight:700; margin-top:10px}
    .faq dd{margin:6px 0 14px 0; color:#c9d7ef}
    .cta-sticky{
      position:sticky; bottom:0; z-index:9; padding:10px; background:linear-gradient(0deg, rgba(10,14,21,.95), rgba(10,14,21,.65) 70%, rgba(10,14,21,0));
      border-top:1px solid #1c2a44; margin-top:10px;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
    }
    .badge-mini{font-size:11px; color:#9fb7dd}
    footer{color:#a8b9d7; font-size:12px; padding:24px 0 50px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .mt-10{margin-top:10px}
    @media (max-width: 900px){
      .hero{grid-template-columns:1fr}
      .layout{grid-template-columns:1fr}
      .sticky{position:static; max-height:unset}
      .row{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <div class="container hero">
      <div>
        <span class="badge" aria-label="Informations">üõ°Ô∏è Estimation indicative ‚Äî ne constitue pas un conseil juridique</span>
        <h1>Simulateur d‚Äôindemnisation ‚Äì Dommage corporel</h1>
        <p class="sub">Obtenez une estimation <strong>approximative</strong> selon vos informations, puis recevez une <strong>√©valuation affin√©e gratuite</strong> par le cabinet.</p>
      </div>
      <aside class="card">
        <div class="note">Pourquoi nous contacter ?</div>
        <ul class="list">
          <li>‚úÖ 1<sup>er</sup> rendez-vous offert</li>
          <li>‚úÖ Honoraires au r√©sultat possibles</li>
          <li>‚úÖ R√©ponse sous 24h ouvr√©es</li>
        </ul>
      </aside>
    </div>
  </header>

  <main class="container grid layout" role="main">
    <section class="card" aria-labelledby="wizard-title">
      <h2 id="wizard-title" class="sr-only">Assistant pas-√†-pas</h2>

      <div class="stepper" aria-label="Progression">
        <div class="step" id="step-badge-1" aria-current="step">1. Profil & contexte</div>
        <div class="step" id="step-badge-2">2. Pr√©judices & montants</div>
        <div class="step" id="step-badge-3">3. R√©sultat & contact</div>
      </div>

      <!-- Step 1 -->
      <form id="form" novalidate>
        <div class="step-card" data-step="1" aria-labelledby="s1">
          <h3 id="s1">Profil & contexte</h3>
          <div class="row">
            <div>
              <label for="typeAccident">Type d‚Äôaccident</label>
              <select id="typeAccident" name="typeAccident" aria-describedby="typeHelp">
                <option value="">Choisir‚Ä¶</option>
                <option>Circulation</option>
                <option>M√©dical</option>
                <option>Agression</option>
                <option>Travail</option>
                <option>Autre</option>
              </select>
              <div class="help" id="typeHelp">Information indicative pour contextualiser l‚Äôestimation.</div>
            </div>
            <div>
              <label for="dateAccident">Date de l‚Äôaccident</label>
              <input id="dateAccident" name="dateAccident" type="date" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="age">√Çge</label>
              <input id="age" name="age" type="number" inputmode="numeric" min="0" max="120" placeholder="Ex. 42" />
            </div>
            <div>
              <label for="departement">D√©partement</label>
              <input id="departement" name="departement" type="text" placeholder="Ex. 75 ou 2A" pattern="^(2A|2B|0[1-9]|[1-8][0-9]|9[0-5]|97[1-6]|98[0-8])$" aria-describedby="depHelp"/>
              <div class="help" id="depHelp">Format accept√© : 01 √† 95, 2A, 2B, 971‚Äì976, 980‚Äì988.</div>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="hospitalisation">Hospitalisation (jours)</label>
              <input id="hospitalisation" name="hospitalisation" type="number" min="0" step="1" placeholder="0" />
            </div>
            <div>
              <label for="itt">ITT (jours)</label>
              <input id="itt" name="itt" type="number" min="0" step="1" placeholder="0" />
            </div>
          </div>
          <div class="alert warn" role="note">Estimation indicative. Chaque dossier est unique et n√©cessite une analyse compl√®te.</div>

          <div class="actions">
            <span></span>
            <button type="button" class="btn primary" data-next>Suivant</button>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="step-card" data-step="2" hidden aria-labelledby="s2">
          <h3 id="s2">Pr√©judices & montants (nomenclature Dintilhac simplifi√©e)</h3>
          <div class="row">
            <div>
              <label for="depensesSante">D√©penses de sant√© (rest√©es √† charge) ‚Ç¨</label>
              <input id="depensesSante" name="depensesSante" type="number" min="0" step="50" placeholder="0" />
              <div class="help">Ex. soins non rembours√©s, d√©placements, mat√©riel‚Ä¶</div>
            </div>
            <div>
              <label for="autresFrais">Autres frais ‚Ç¨</label>
              <input id="autresFrais" name="autresFrais" type="number" min="0" step="50" placeholder="0" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="pertesRevenus">Pertes de revenus (‚Ç¨/mois)</label>
              <input id="pertesRevenus" name="pertesRevenus" type="number" min="0" step="50" placeholder="0" />
            </div>
            <div>
              <label for="dureeMois">Dur√©e (mois)</label>
              <input id="dureeMois" name="dureeMois" type="number" min="0" step="1" placeholder="0" />
              <div class="help">Utilis√©e aussi pour l‚Äôassistance tierce personne (√† d√©faut d‚Äôautre dur√©e).</div>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="heuresSem">Assistance tierce personne (heures/sem.)</label>
              <input id="heuresSem" name="heuresSem" type="number" min="0" step="1" placeholder="0" />
            </div>
            <div>
              <label for="tarifHoraire">Tarif horaire (‚Ç¨/h)</label>
              <input id="tarifHoraire" name="tarifHoraire" type="number" min="0" step="1" placeholder="0" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="ipp">DFP / IPP (%)</label>
              <input id="ipp" name="ipp" type="range" min="0" max="100" step="1" value="0" aria-describedby="ippOut"/>
              <div class="help"><output id="ippOut">0%</output> (valeur indicative par point)</div>
            </div>
            <div>
              <label for="souffrances">Souffrances endur√©es (1‚Äì7)</label>
              <input id="souffrances" name="souffrances" type="range" min="1" max="7" step="1" value="3" aria-describedby="soufOut"/>
              <div class="help"><output id="soufOut">3/7</output> (√©chelle indiciaire)</div>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="esthetique">Pr√©judice esth√©tique (0‚Äì7)</label>
              <input id="esthetique" name="esthetique" type="range" min="0" max="7" step="1" value="0" aria-describedby="esthOut"/>
              <div class="help"><output id="esthOut">0/7</output></div>
            </div>
            <div>
              <label for="agrement">Pr√©judice d‚Äôagr√©ment</label>
              <select id="agrement" name="agrement">
                <option value="non">Non</option>
                <option value="oui">Oui</option>
              </select>
            </div>
          </div>
          <div class="actions">
            <button type="button" class="btn" data-prev>Pr√©c√©dent</button>
            <button type="button" class="btn primary" data-next>Voir l‚Äôestimation</button>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="step-card" data-step="3" hidden aria-labelledby="s3">
          <h3 id="s3">R√©sultat & prise de contact</h3>
          <div class="alert ok">Estimation indicative bas√©e sur vos informations ‚Äî √† confirmer par un avocat.</div>
          <div class="result-grid" aria-live="polite">
            <div class="pill"><span>Estimation basse</span><strong id="resLow">‚Äî</strong></div>
            <div class="pill"><span>Estimation m√©diane</span><strong id="resMed">‚Äî</strong></div>
            <div class="pill"><span>Estimation haute</span><strong id="resHigh">‚Äî</strong></div>
          </div>
          <div class="meter">
            <div>Visualisation</div>
            <div class="bar" aria-hidden="true"><i id="barMed"></i></div>
          </div>
          <details class="mt-10">
            <summary>Voir la r√©partition par postes</summary>
            <ul class="list" id="breakdown"></ul>
          </details>

          <div class="cta-sticky">
            <div>
              <div class="badge-mini">Besoin d‚Äôune √©valuation pr√©cise ?</div>
              <div><strong>Obtenez une estimation affin√©e gratuite</strong></div>
            </div>
            <a href="#contact" class="btn primary" data-analytics="cta_contact">Contacter le cabinet</a>
          </div>

          <h4 id="contact">Formulaire de contact</h4>
          <div class="note">Vos donn√©es restent strictement confidentielles. Nous ne contactons pas votre assureur sans votre accord.</div>
          <div class="row">
            <div>
              <label for="nom">Nom</label>
              <input id="nom" name="nom" required placeholder="Votre nom" />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" required placeholder="vous@exemple.com" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="tel">T√©l√©phone</label>
              <input id="tel" name="tel" type="tel" required placeholder="06 12 34 56 78" pattern="^0[1-9](?:[ .-]?[0-9]{2}){4}$" aria-describedby="telHelp"/>
              <div class="help" id="telHelp">Format FR. Ex : 06 12 34 56 78</div>
            </div>
            <div>
              <label for="ville">Ville</label>
              <input id="ville" name="ville" placeholder="Votre ville" />
            </div>
          </div>
          <div>
            <label for="message">Message</label>
            <textarea id="message" name="message" rows="4" placeholder="D√©crivez bri√®vement la situation"></textarea>
          </div>
          <div class="row">
            <label><input type="checkbox" id="consentData" /> J‚Äôaccepte le traitement de mes donn√©es pour √™tre recontact√©(e).</label>
            <label><input type="checkbox" id="consentContact" /> J‚Äôautorise le cabinet √† me contacter.</label>
          </div>
          <div class="actions">
            <button type="button" id="sendBtn" class="btn primary" disabled>Envoyer</button>
          </div>

          <div id="sendStatus" class="note" role="status" aria-live="polite"></div>

          <div class="mt-10 alert">
            <strong>Confidentialit√© & transparence</strong>
            <ul class="list">
              <li>üîí Donn√©es trait√©es confidentiellement par le cabinet.</li>
              <li>üóÇÔ∏è Aucun document m√©dical sensible stock√© sans votre accord pr√©alable.</li>
              <li>üìß Vous pouvez demander la suppression de vos donn√©es √† tout moment.</li>
            </ul>
          </div>

          <h4>FAQ</h4>
          <dl class="faq">
            <dt>Combien de temps pour un premier retour ?</dt>
            <dd>En moyenne sous 24h ouvr√©es.</dd>
            <dt>Quels documents pr√©parer ?</dt>
            <dd>Certificat m√©dical initial, comptes-rendus, justificatifs de frais, arr√™ts de travail, fiches de paie, √©changes avec assureurs.</dd>
            <dt>Les honoraires sont-ils au r√©sultat ?</dt>
            <dd>Selon le dossier : un honoraire fixe et/ou un honoraire de r√©sultat sont possibles.</dd>
            <dt>Cette estimation a-t-elle une valeur juridique ?</dt>
            <dd>Non. Il s‚Äôagit d‚Äôun outil indicatif. Seule une analyse compl√®te permet d‚Äô√©valuer votre pr√©judice.</dd>
            <dt>Pouvez-vous intervenir partout en France ?</dt>
            <dd>Oui, avec un r√©seau de m√©decins-conseils. Pr√©cisez votre d√©partement.</dd>
          </dl>
        </div>
      </form>
    </section>

    <aside class="card sticky" aria-labelledby="resume-title">
      <h2 id="resume-title">R√©sum√© & estimation</h2>
      <div class="list">
        <div>Type : <strong id="rType">‚Äî</strong></div>
        <div>√Çge : <strong id="rAge">‚Äî</strong></div>
        <div>IPP : <strong id="rIPP">0%</strong></div>
        <div>Souffrances : <strong id="rSouf">3/7</strong></div>
        <div>Esth√©tique : <strong id="rEsth">0/7</strong></div>
      </div>
      <div class="result-grid">
        <div class="pill"><span>Basse</span><strong id="sumLow">‚Äî</strong></div>
        <div class="pill"><span>M√©diane</span><strong id="sumMed">‚Äî</strong></div>
        <div class="pill"><span>Haute</span><strong id="sumHigh">‚Äî</strong></div>
      </div>
      <div class="meter">
        <div class="bar" aria-hidden="true"><i id="sumBar"></i></div>
      </div>
      <p class="note">‚ö†Ô∏è Ces montants sont indicatifs et devront √™tre confirm√©s par un avocat.</p>
    </aside>
  </main>

  <footer class="container">
    ¬© Cabinet d‚Äôavocat ‚Äî Dommage corporel ‚Äî Barreau de [VILLE] ‚Äî Tous droits r√©serv√©s ¬∑
    <a href="#" aria-label="Politique de confidentialit√©">Politique de confidentialit√©</a>
  </footer>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Attorney",
    "name": "Cabinet d‚Äôavocat ‚Äî Dommage corporel",
    "areaServed": "France",
    "url": "",
    "address": {"@type":"PostalAddress", "addressCountry":"FR"},
    "telephone": "",
    "priceRange": "‚Ç¨‚Ç¨"
  }
  </script>

  <script type="module">
    // ---------- State & helpers ----------
    const fmtEUR = (n) => new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(n||0);
    const clamp = (v,min,max)=>Math.max(min, Math.min(max, v));
    const byId = (id)=>document.getElementById(id);
    const state = {
      typeAccident: '', dateAccident: '', age: '', departement:'',
      hospitalisation:0, itt:0,
      depensesSante:0, autresFrais:0,
      pertesRevenus:0, dureeMois:0,
      heuresSem:0, tarifHoraire:0,
      ipp:0, souffrances:3, esthetique:0, agrement:'non'
    };

    const bareme = {
      souffrances: {
        1:[500,1500],2:[1500,3000],3:[3000,7000],4:[7000,15000],5:[15000,30000],6:[30000,60000],7:[60000,100000]
      },
      esthetique: {
        0:[0,0],1:[300,1000],2:[800,2000],3:[2000,5000],4:[5000,10000],5:[10000,20000],6:[20000,40000],7:[40000,70000]
      },
      ippTranches: [
        {max:10, low:800, high:1500},
        {max:20, low:1500, high:2500},
        {max:30, low:2500, high:4000},
        {max:100, low:4000, high:7000}
      ],
      agrement:[1000,10000],
      marge:0.10 // 10% marge d‚Äôincertitude
    };

    function eurosParPoint(ipp){
      for(const t of bareme.ippTranches){
        if(ipp <= t.max) return [t.low, t.high];
      }
      return [0,0];
    }

    function parseFloatSafe(v){ const n = parseFloat(v); return isNaN(n) ? 0 : n; }

    function calcEstimation(s){
      // Base
      const depenses = s.depensesSante + s.autresFrais;
      const pertes = s.pertesRevenus * s.dureeMois;
      const assistance = s.heuresSem * s.tarifHoraire * 4.33 * s.dureeMois;
      const base = depenses + pertes + assistance;

      // DFP/IPP
      const [ippLowPer, ippHighPer] = eurosParPoint(s.ipp);
      const ippLow = s.ipp * ippLowPer;
      const ippHigh = s.ipp * ippHighPer;
      const ippMed = s.ipp * ((ippLowPer + ippHighPer)/2);

      // Souffrances
      const se = bareme.souffrances[s.souffrances] || [0,0];
      const seLow = se[0], seHigh = se[1], seMed = (seLow+seHigh)/2;

      // Esth√©tique
      const esth = bareme.esthetique[s.esthetique] || [0,0];
      const esthLow = esth[0], esthHigh = esth[1], esthMed = (esthLow+esthHigh)/2;

      // Agr√©ment
      const agr = s.agrement === 'oui' ? bareme.agrement : [0,0];
      const agrLow = agr[0], agrHigh = agr[1], agrMed = (agrLow+agrHigh)/2;

      const lowCore = base + ippLow + seLow + esthLow + agrLow;
      const highCore = base + ippHigh + seHigh + esthHigh + agrHigh;
      const medCore = base + ippMed + seMed + esthMed + agrMed;

      const low = Math.max(0, Math.round(lowCore * (1 - bareme.marge)));
      const high = Math.max(0, Math.round(highCore * (1 + bareme.marge)));
      const med = Math.max(0, Math.round(medCore));

      const breakdown = [
        ['D√©penses & autres frais', depenses],
        ['Pertes de revenus', pertes],
        ['Assistance tierce personne', assistance],
        ['DFP/IPP', ippMed],
        ['Souffrances endur√©es', seMed],
        ['Pr√©judice esth√©tique', esthMed],
        ['Agr√©ment', agrMed]
      ];

      return { low, med, high, base, breakdown };
    }

    function updateStateFromInputs(){
      for(const key in state){
        const el = byId(key);
        if(!el) continue;
        let v = el.value;
        if(['depensesSante','autresFrais','pertesRevenus','dureeMois','heuresSem','tarifHoraire','hospitalisation','itt','age','ipp','souffrances','esthetique'].includes(key)){
          v = parseFloatSafe(v);
        }
        state[key] = v;
      }
      // mirrors
      byId('rType').textContent = state.typeAccident || '‚Äî';
      byId('rAge').textContent = state.age ? state.age + ' ans' : '‚Äî';
      byId('rIPP').textContent = (state.ipp|0) + '%';
      byId('rSouf').textContent = (state.souffrances|0) + '/7';
      byId('rEsth').textContent = (state.esthetique|0) + '/7';
      byId('ippOut').textContent = (state.ipp|0) + '%';
      byId('soufOut').textContent = (state.souffrances|0) + '/7';
      byId('esthOut').textContent = (state.esthetique|0) + '/7';
    }

    function renderEstimation(){
      const {low, med, high, breakdown} = calcEstimation(state);
      const span = Math.max(1, high - low);
      const pct = clamp(((med - low) / span) * 100, 0, 100);

      // main result
      byId('resLow').textContent = fmtEUR(low);
      byId('resMed').textContent = fmtEUR(med);
      byId('resHigh').textContent = fmtEUR(high);
      byId('barMed').style.width = pct + '%';

      // summary card
      byId('sumLow').textContent = fmtEUR(low);
      byId('sumMed').textContent = fmtEUR(med);
      byId('sumHigh').textContent = fmtEUR(high);
      byId('sumBar').style.width = pct + '%';

      // breakdown
      const ul = byId('breakdown');
      ul.innerHTML = '';
      breakdown.forEach(([label, val])=>{
        const li = document.createElement('li');
        li.innerHTML = `‚Ä¢ ${label} : <strong>${fmtEUR(val)}</strong>`;
        ul.appendChild(li);
      });

      // enable contact send if consents are checked
      byId('sendBtn').disabled = !(byId('consentData').checked && byId('consentContact').checked);
    }

    function stepTo(n){
      for(const el of document.querySelectorAll('.step-card')){
        el.hidden = el.dataset.step !== String(n);
      }
      for(const i of [1,2,3]){
        byId('step-badge-'+i).classList.toggle('active', i===n);
        byId('step-badge-'+i).setAttribute('aria-current', i===n ? 'step' : 'false');
      }
      // compute always
      updateStateFromInputs(); renderEstimation();
    }

    // ---------- Init ----------
    for(const el of document.querySelectorAll('input, select, textarea')){
      el.addEventListener('input', ()=>{ updateStateFromInputs(); renderEstimation(); });
      el.addEventListener('change', ()=>{ updateStateFromInputs(); renderEstimation(); });
    }
    for(const el of document.querySelectorAll('[data-next]')){
      el.addEventListener('click', ()=>{
        const cur = Number(document.querySelector('.step-card:not([hidden])')?.dataset.step || 1);
        stepTo(Math.min(3, cur+1));
        window.scrollTo({top:0, behavior:'smooth'});
      });
    }
    for(const el of document.querySelectorAll('[data-prev]')){
      el.addEventListener('click', ()=>{
        const cur = Number(document.querySelector('.step-card:not([hidden])')?.dataset.step || 1);
        stepTo(Math.max(1, cur-1));
        window.scrollTo({top:0, behavior:'smooth'});
      });
    }

    // consent toggles
    byId('consentData').addEventListener('change', renderEstimation);
    byId('consentContact').addEventListener('change', renderEstimation);

    // send handler
    byId('sendBtn').addEventListener('click', async ()=>{
      const sendBtn = byId('sendBtn');
      const status = byId('sendStatus');
      status.textContent = 'Envoi en cours‚Ä¶';
      sendBtn.disabled = true;

      const payload = {
        nom: byId('nom').value.trim(),
        email: byId('email').value.trim(),
        tel: byId('tel').value.trim(),
        ville: byId('ville').value.trim(),
        message: byId('message').value.trim(),
        estimation: {
          low: byId('resLow').textContent,
          med: byId('resMed').textContent,
          high: byId('resHigh').textContent
        }
      };

      // simple validation
      if(!payload.nom || !payload.email || !payload.tel){
        status.textContent = 'Veuillez renseigner nom, email et t√©l√©phone.';
        sendBtn.disabled = false;
        return;
      }

      try{
        const res = await fetch('/api/leads', {
          method:'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if(!res.ok) throw new Error('HTTP '+res.status);
        status.textContent = 'Merci ! Nous vous recontactons rapidement.';
      }catch(e){
        // fallback mailto
        const subject = encodeURIComponent('Demande d‚Äôestimation ‚Äî dommage corporel');
        const body = encodeURIComponent(
          'Nom: ' + payload.nom + '\n' +
          'Email: ' + payload.email + '\n' +
          'T√©l√©phone: ' + payload.tel + '\n' +
          'Ville: ' + payload.ville + '\n\n' +
          'Message:\n' + payload.message + '\n\n' +
          'Estimation: ' + payload.estimation.low + ' ‚Äì ' + payload.estimation.med + ' ‚Äì ' + payload.estimation.high
        );
        status.innerHTML = 'Serveur indisponible. Vous pouvez <a href="mailto:contact@cabinet-exemple.fr?subject=' + subject + '&body=' + body + '">envoyer un email</a> (pr√©rempli).';
      }finally{
        sendBtn.disabled = false;
      }
    });

    // first render
    updateStateFromInputs();
    renderEstimation();
  </script>
</body>
</html>
